/**
 * @license
 * 
 * shelly-porssisahko
 * 
 * (c) Jussi isotalo - http://jisotalo.fi
 * https://github.com/jisotalo/shelly-porssisahko
 * 
 * License: GNU Affero General Public License v3.0 
 */
const CNST={INST_COUNT:"undefined"==typeof INSTANCE_COUNT?3:INSTANCE_COUNT,HIST_LEN:24,ERR_LIMIT:3,ERR_DELAY:120,DEF_INST_ST:{chkTs:0,st:0,str:"",cmd:-1,configOK:0,fCmdTs:0,fCmd:0},DEF_CFG:{COM:{g:"fi",vat:25.5,day:0,night:0,names:[]},INST:{en:0,mode:0,m0:{c:0},m1:{l:0},m2:{p:24,c:0,l:-999,s:0,m:999,ps:0,pe:23,ps2:0,pe2:23,c2:0},b:0,e:0,o:[0],f:0,fc:0,i:0,m:60,oc:0}}};let _={s:{v:"3.0.0-beta1",dn:"",configOK:0,timeOK:0,errCnt:0,errTs:0,upTs:0,tz:"+02:00",tzh:0,enCnt:0,p:[{ts:0,now:0,low:0,high:0,avg:0},{ts:0,now:0,low:0,high:0,avg:0}]},si:[CNST.DEF_INST_ST],p:[[],[]],h:[],c:{c:CNST.DEF_CFG.COM,i:[CNST.DEF_CFG.INST]}},_i=0,_j=0,_k=0,_inc=0,_cnt=0,_start=0,_end=0,cmd=[],loopRunning=!1;function getKvsKey(t){let e="porssi";return e=0<=t?e+"-"+(t+1):e}function isCurrentHour(t,e){e-=t;return 0<=e&&e<3600}function limit(t,e,n){return Math.min(n,Math.max(t,e))}function epoch(t){return Math.floor((t?t.getTime():Date.now())/1e3)}function getDate(t){return t.getDate()}function updateTz(t){let e=t.toString(),n=0;"+0000"==(e=e.substring(3+e.indexOf("GMT")))?(e="Z",n=0):(n=+e.substring(0,3),e=e.substring(0,3)+":"+e.substring(3)),e!=_.s.tz&&(_.s.p[0].ts=0),_.s.tz=e,_.s.tzh=n}function log(t){console.log("shelly-porssisahko: "+t)}function addHistory(t){for(var e=0<_.s.enCnt?CNST.HIST_LEN/_.s.enCnt:CNST.HIST_LEN;0<CNST.HIST_LEN&&_.h[t].length>=e;)_.h[t].splice(0,1);_.h[t].push([epoch(),cmd[t]?1:0,_.si[t].st])}function updateState(){var t=new Date;for(_.s.timeOK=2e3<t.getFullYear()?1:0,_.s.dn=Shelly.getComponentConfig("sys").device.name,_.s.enCnt=0,_i=0;_i<CNST.INST_COUNT;_i++)_.c.i[_i].en&&_.s.enCnt++;!_.s.upTs&&_.s.timeOK&&(_.s.upTs=epoch(t))}function getConfig(l){var t=getKvsKey(l);Shelly.call("KVS.Get",{key:t},function(e,t,n){l<0?_.c.c=e?JSON.parse(e.value):{}:_.c.i[l]=e?JSON.parse(e.value):{};{e=l;var s=function(t){l<0?_.s.configOK=t?1:0:(log("config for #"+l+" read, enabled: "+_.c.i[l].en),_.si[l].configOK=t?1:0,_.si[l].chkTs=0),loopRunning=!1,Timer.set(500,!1,loop)};let t=0;if(CNST.DEF_CFG.COM||CNST.DEF_CFG.INST){var i,o=e<0?CNST.DEF_CFG.COM:CNST.DEF_CFG.INST,r=e<0?_.c.c:_.c.i[e];for(i in o)if(void 0===r[i])r[i]=o[i],t++;else if("object"==typeof o[i])for(var c in o[i])void 0===r[i][c]&&(r[i][c]=o[i][c],t++);e>=CNST.INST_COUNT-1&&(CNST.DEF_CFG.COM=null,CNST.DEF_CFG.INST=null),0<t?(e=getKvsKey(e),Shelly.call("KVS.Set",{key:e,value:JSON.stringify(r)},function(t,e,n,s){e&&log("failed to set config: "+e+" - "+n),s(0==e)},s)):s(!0)}else s(!0)}})}function loop(){if(!loopRunning)if(loopRunning=!0,updateState(),_.s.configOK)if(pricesNeeded(0))getPrices(0);else if(pricesNeeded(1))getPrices(1);else{for(let t=0;t<CNST.INST_COUNT;t++)if(!_.si[t].configOK)return void getConfig(t);for(let t=0;t<CNST.INST_COUNT;t++)if(function(t){var e=_.si[t],n=_.c.i[t];if(1!=n.en)return void(_.h[t]=[]);var t=new Date,s=new Date(1e3*e.chkTs);return 0==e.chkTs||s.getHours()!=t.getHours()||s.getFullYear()!=t.getFullYear()||0<e.fCmdTs&&e.fCmdTs-epoch(t)<0||0==e.fCmdTs&&n.m<60&&t.getMinutes()>=n.m&&e.cmd+n.i==1}(t))return void Timer.set(500,!1,logic,t);loopRunning=!1}else getConfig(-1)}function pricesNeeded(t){var e=new Date;let n=!1;return n=1==t?_.s.timeOK&&0===_.s.p[1].ts&&15<=e.getHours():((t=getDate(new Date(1e3*_.s.p[0].ts))!==getDate(e))&&(_.s.p[1].ts=0,_.p[1]=[]),_.s.timeOK&&(0==_.s.p[0].ts||t)),_.s.errCnt>=CNST.ERR_LIMIT&&epoch(e)-_.s.errTs<CNST.ERR_DELAY?n=!1:_.s.errCnt>=CNST.ERR_LIMIT&&(_.s.errCnt=0),n}function getPrices(c){try{log("fetching prices for day "+c);let o=new Date;updateTz(o);var e=1==c?new Date(864e5+new Date(o.getFullYear(),o.getMonth(),o.getDate()).getTime()):o;let t=e.getFullYear()+"-"+(e.getMonth()<9?"0"+(1+e.getMonth()):1+e.getMonth())+"-"+(getDate(e)<10?"0"+getDate(e):getDate(e))+"T00:00:00"+_.s.tz.replace("+","%2b");var n=t.replace("T00:00:00","T23:59:59");let r={url:"https://dashboard.elering.ee/api/nps/price/csv?fields="+_.c.c.g+"&start="+t+"&end="+n,timeout:5,ssl_ca:"*"};o=null,t=null,Shelly.call("HTTP.GET",r,function(e,t,n){r=null;try{if(0!==t||null==e||200!==e.code||!e.body_b64)throw Error(t+"("+n+") - "+JSON.stringify(e));{e.headers=null,n=e.message=null,_.p[c]=[],_.s.p[c].avg=0,_.s.p[c].high=-999,_.s.p[c].low=999,e.body_b64=atob(e.body_b64),e.body_b64=e.body_b64.substring(1+e.body_b64.indexOf("\n"));let t=0;for(;0<=t;){e.body_b64=e.body_b64.substring(t);var s=[t=0,0];if(0===(t=1+e.body_b64.indexOf('"',t)))break;s[0]=+e.body_b64.substring(t,e.body_b64.indexOf('"',t)),t=2+e.body_b64.indexOf('"',t),t=2+e.body_b64.indexOf(';"',t),s[1]=+(""+e.body_b64.substring(t,e.body_b64.indexOf('"',t)).replace(",",".")),s[1]=s[1]/10*(100+(0<s[1]?_.c.c.vat:0))/100;var i=new Date(1e3*s[0]).getHours();s[1]+=7<=i&&i<22?_.c.c.day:_.c.c.night,_.p[c].push(s),_.s.p[c].avg+=s[1],s[1]>_.s.p[c].high&&(_.s.p[c].high=s[1]),s[1]<_.s.p[c].low&&(_.s.p[c].low=s[1]),t=e.body_b64.indexOf("\n",t)}if(e=null,_.s.p[c].avg=0<_.p[c].length?_.s.p[c].avg/_.p[c].length:0,_.s.p[c].ts=epoch(o),1==c&&_.p[c].length<23)throw Error("no prices tomorrow")}}catch(t){log("error getting prices: "+t),_.s.errCnt+=1,_.s.errTs=epoch(),_.s.p[c].ts=0,_.p[c]=[]}loopRunning=!1,Timer.set(500,!1,loop)})}catch(t){log("error getting prices: "+t),_.s.p[c].ts=0,_.p[c]=[],loopRunning=!1}}function logic(o){try{cmd[o]=!1;var t,e,n=new Date;updateTz(n),!function(){if(_.s.timeOK&&0!=_.s.p[0].ts){var e=epoch();for(let t=0;t<_.p[0].length;t++)if(isCurrentHour(_.p[0][t][0],e))return _.s.p[0].now=_.p[0][t][1];return _.p[0].length<24&&(_.s.p[0].ts=0),_.s.p[0].now=0}_.s.p[0].now=0}();let s=_.si[o],i=_.c.i[o];0===i.mode?(cmd[o]=1===i.m0.c,s.st=1):_.s.timeOK&&0<_.s.p[0].ts&&getDate(new Date(1e3*_.s.p[0].ts))===getDate(n)?1===i.mode?(cmd[o]=_.s.p[0].now<=("avg"==i.m1.l?_.s.p[0].avg:i.m1.l),s.st=cmd[o]?2:3):2===i.mode&&(cmd[o]=function(t){var e=_.c.i[t],n=(e.m2.ps=limit(0,e.m2.ps,23),e.m2.pe=limit(e.m2.ps,e.m2.pe,24),e.m2.ps2=limit(0,e.m2.ps2,23),e.m2.pe2=limit(e.m2.ps2,e.m2.pe2,24),e.m2.c=limit(0,e.m2.c,0<e.m2.p?e.m2.p:e.m2.pe-e.m2.ps),e.m2.c2=limit(0,e.m2.c2,e.m2.pe2-e.m2.ps2),[]);for(_inc=e.m2.p<0?1:e.m2.p,_i=0;_i<_.p[0].length;_i+=_inc)if(!((_cnt=-2==e.m2.p&&1<=_i?e.m2.c2:e.m2.c)<=0)){var s=[];for(_start=_i,_end=_i+e.m2.p,e.m2.p<0&&0==_i?(_start=e.m2.ps,_end=e.m2.pe):-2==e.m2.p&&1==_i&&(_start=e.m2.ps2,_end=e.m2.pe2),_j=_start;_j<_end&&!(_j>_.p[0].length-1);_j++)s.push(_j);if(e.m2.s){for(_avg=999,_startIndex=0,_j=0;_j<=s.length-_cnt;_j++){for(_sum=0,_k=_j;_k<_j+_cnt;_k++)_sum+=_.p[0][s[_k]][1];_sum/_cnt<_avg&&(_avg=_sum/_cnt,_startIndex=_j)}for(_j=_startIndex;_j<_startIndex+_cnt;_j++)n.push(s[_j])}else{for(_j=0,_k=1;_k<s.length;_k++){var i=s[_k];for(_j=_k-1;0<=_j&&_.p[0][i][1]<_.p[0][s[_j]][1];_j--)s[_j+1]=s[_j];s[_j+1]=i}for(_j=0;_j<_cnt;_j++)n.push(s[_j])}if(-1==e.m2.p||-2==e.m2.p&&1<=_i)break}let o=epoch(),r=!1;for(let t=0;t<n.length;t++)if(isCurrentHour(_.p[0][n[t]][0],o)){r=!0;break}return r}(o),s.st=cmd[o]?5:4,!cmd[o]&&_.s.p[0].now<=("avg"==i.m2.l?_.s.p[0].avg:i.m2.l)&&(cmd[o]=!0,s.st=6),cmd[o])&&_.s.p[0].now>("avg"==i.m2.m?_.s.p[0].avg:i.m2.m)&&(cmd[o]=!1,s.st=11):_.s.timeOK?(s.st=7,t=1<<n.getHours(),(i.b&t)==t&&(cmd[o]=!0)):(cmd[o]=1===i.e,s.st=8),_.s.timeOK&&0<i.f&&(e=1<<n.getHours(),(i.f&e)==e)&&(cmd[o]=(i.fc&e)==e,s.st=10),cmd[o]&&_.s.timeOK&&n.getMinutes()>=i.m&&(s.st=13,cmd[o]=!1),_.s.timeOK&&0<s.fCmdTs&&(0<s.fCmdTs-epoch(n)?(cmd[o]=1==s.fCmd,s.st=9):s.fCmdTs=0);var r=cmd[o];if(null==r)loopRunning=!1;else if(cmd[o]!=r&&(s.st=12),cmd[o]=r,i.i&&(cmd[o]=!cmd[o]),log("logic for #"+o+" done, cmd: "+r+" -> output: "+cmd[o]),1==i.oc&&s.cmd==cmd[o])log("outputs already set for #"+o),addHistory(o),s.cmd=cmd[o]?1:0,s.chkTs=epoch(),loopRunning=!1;else{let e=0,n=0;for(let t=0;t<i.o.length;t++)!function(t,i,o){t="{id:"+i+",on:"+(cmd[t]?"true":"false")+"}",Shelly.call("Switch.Set",t,function(t,e,n,s){0!=e&&log("setting output "+i+" failed: "+e+" - "+n),o(0==e)},o)}(o,i.o[t],function(t){e++,t&&n++,e==i.o.length&&(n==e&&(addHistory(o),s.cmd=cmd[o]?1:0,s.chkTs=epoch(),Timer.set(500,!1,loop)),loopRunning=!1)})}}catch(t){log("error running logic: "+JSON.stringify(t)),loopRunning=!1}}let _avg=999,_startIndex=0,_sum=0;log("v."+_.s.v),log("URL: http://"+(Shelly.getComponentStatus("wifi").sta_ip??"192.168.33.1")+"/script/"+Shelly.getCurrentScriptId()),_.c.i.pop(),_.si.pop();for(let t=0;t<CNST.INST_COUNT;t++)_.si.push(Object.assign({},CNST.DEF_INST_ST)),_.c.i.push(Object.assign({},CNST.DEF_CFG.INST)),_.c.c.names.push("-"),_.h.push([]),cmd.push(!1);CNST.DEF_INST_ST=null,HTTPServer.registerEndpoint("",function(n,s){try{if(loopRunning)return n=null,s.code=503,s.headers=[["Access-Control-Allow-Origin","*"]],void s.send();var i=function(t){var e={},n=t.split("&");for(let t=0;t<n.length;t++){var s=n[t].split("=");e[s[0]]=s[1]}return e}(n.query),o=parseInt(i.i);n=null;let t="application/json",e=(s.code=200,!0);var r="text/html",c="text/javascript";!isNaN(o)&&(o<0||o>=CNST.INST_COUNT)?s.code=400:"s"===i.r?(updateState(),0<=o&&o<CNST.INST_COUNT?s.body=JSON.stringify({s:_.s,si:_.si[o],c:_.c.c,ci:_.c.i[o],p:_.p}):s.body=JSON.stringify(_),e=!1):"c"===i.r?(updateState(),0<=o&&o<CNST.INST_COUNT?s.body=JSON.stringify(_.c.i[o]):s.body=JSON.stringify(_.c.c),e=!1):"h"===i.r?(0<=o&&o<CNST.INST_COUNT&&(s.body=JSON.stringify(_.h[o])),e=!1):"r"===i.r?(log("config changed for #"+o),_.s.configOK=!1,_.si[o].configOK=!1,loopRunning||(loopRunning=!0,getConfig(o)),_.s.p[0].ts=0,_.s.p[1].ts=0,s.code=204,e=!1):"f"===i.r&&i.ts?(_.si[o].fCmdTs=+(""+i.ts),_.si[o].fCmd=+(""+i.c),_.si[o].chkTs=0,s.code=204,e=!1):i.r?"s.js"===i.r?(s.body=atob("H4sIAAAAAAAACo1Wa3IbNxK+yghRWEANBJPJ5g9pSJVYShyvbLlMxlVbKlXUnmmJEEGAAnpos+i5Dc+QC/BiW5ghKUpRvPuHD+Dr99fdsEjZHx/ONWPyjw/nw/RtXCTdlVCQmeMIPqWz0he69EU1RUfyPmrSx6Uv1H2FYTFEiwX5wNl3LCchT3/5TXOhj5e1HI5+Hp39ORx90Jfs3+vVwjkTCWm9Wq8ck+koGj++gyoyyV4bR5CBtZgFuAO3O1pY8+QETTYGOzfTmYGM1itr16ssIe5gEr21sEP+n7DGKhgH2Sw51wCPtjY/QphWVaTK0cbbjCcPjCN/BzIDM4GMDJY+RhBJ53pF6xUZC1t4A0HzCPUeJhN/tEV8HzOIZB5fEFVZY/ZRLqYwiWZqtu6lxBKtV3frlcviJJjZzs2FNRMT7rwhghTsqHLOuKy9nRpXVWQomyQFSLRgV/LtxelewZ5WJ5lkkr1J6XOb3E6Bko/OELuSkYBQz70ps6589ctQX17JKTZ0YExa72cjM8WgXWWt9DN0iV8QF67ISB8vW8EDranTYSx9f/3KSTOCT0dJdRWZkJ+NK/1nZX0BZLxTY4hjTTl7wXKeuJv3xB55aTCHkIG+j5wleg6g0+GgijEWEyz1QVdIxrRu7oujhFDGOQyvR2/POx34DIaymZ9VFghPFw6mpjgFAk45U2OaWiY3YrKalUB47v2MH3RFLXEO9pV3BMZhGBapLiO4jZpvAvDOeijb6Jt+SY6Sfi48FWfWEGcvmBg07clnECL+7ojTZe9KfP3aE0e9bUI5XXavVLSmQN4TQp6efTwJeP8mclbiXN1FJvp7zopa/q2Xf7aWM0WRCXXjwxkUY076mBSU5dkcHZ2nPnYYOCvG4G6RyVS+nX1FEG6RlClFLYREi2lw/F7q4+WNDzwFGpuExJT33bV4xokWx4Q0ujswLzdiyqK7pfHA5LnYHF2aq7ZyI/xCJyn5/Lkb0b9BKsb7dzEUQtEYHb+pXJGSzksgEMv0qQi/EH96H8SysRBELWoh95TNIKCjd75EFXDq5/hqbGy5Zy7hnyHUhgckIVGBwmJ5evaxYX+ayzk7CZrlpALOLBTIm5ZgkjHxcLTlIxOiIT3qlr63SC1l5UFPDFD5yQm/jxz2mK5RpWD/ibMchOg/FWFnIfiQtJNxt1mS72csR0VfqC4gJZnEsvAueosKE5iTqGu58WcTMUhMXbgJOvltNn63hQIxMDfcKD8RS4uUUTM8BgGpCi77ofuvA62NaqdDp8NJ40krbtRd9I6L/vZvW0kht2i59JP+QVcWvsT+7pC+0O5PIoxsAqO63lh8HBDkLAW9LyBavb1n9F4fLqHuZ4fLfXyd8cPlYx9rcd2aTaHWD8l83gX5xORRrzH2ZnjxTkUKxt2amwUnefHpDgtSt0gXn9374GcYaPEOphg5CZGzrM9y2LdbyxsfppCqhWnlXx8uG/H0P7WEHzbauVAzKIcEgfgPknWZqNXhMo1b3ssbgbfe0ZgL8QzwukX8Wln7H4TAxcZm2hM6tUNLjgb02lchftNwzvpsY9K4ivB/oDmc7ASGWHhXflugz5jYy8kTHx8uOKV0svwhlKax91bE3tgvLEJIGF8R361IIdNGijPjmFCRFhbV3ETzyVhDC82a3xbZYNs09KTZd1MjdoxmedoaYkBN77dLmtqOT6OfDFnU7bmKqnQnDz9zlh2xFHfO3q//CjGauF6NJ+u/WONg0sv2p0IrWSiXeKWmMOObmXb90qeHicvmYCvULLUCO75oHyrfHS4h7zWtQfXLFy3y+Frs22jlmkD6P3V/TK8Dlfje6WwiSqQV6dXxaGdxIf55GskHyfrGOLB2sfxm3semLNHtP2Ui0rZ4D+WVP+GPoq4He+5/e3U2W/1hqW8XaBOz+Nuz6nGAB13x6PUhdg+B3TNI1GLwX3VtukLrCwAA"),t=c):"s.css"===i.r?(s.body=atob("H4sIAAAAAAAACo1WTW/jNhD9K4MNFsh6LVmK16lDoUF7WqBoi17aS9EDRY0s1hRJkONEXsP/vSD1YcVJsL0YJjnD+XjzHrVaLGABvkGljok1znvpebM3ELZvxSf45eC9BOkNcWUggYbIstXq32EnrSUs4qZnq9VOUnMoU2HayWD1zt2/SoHaI4Ovv/8JP9c1OgNfUaPjCv44lEqK0QSe1mkGixUs4ASl6RIvv0m9Y1AaV6FLStMVcIbSVMclcDiBMMo4Bjco6qzOx7PgzMV+58xBVwxu7sQaN1kBSmpMGpS7hhjk6RdsC6iNphAGGWTpw7RT81aqI4O/0FVc8wJa3iXPsqKGwZcHF+yGVZ5lH8Ox20nNIAN+IFOA5VUVM9/YDvLMxrxvSJJCOM2DDmn0/klpiEwbvaKDMPb40j5Lt8GeK7nTiUdVM6gVdgnqqgDCjpJ4xMCFMsMlaa06OEElvVX82JvHfeKlhxNY4yVJE1xQcZJPWLxsX85L8SAmF8ZKrI3D5bjkNaGLYGhCTQw+fCgu4YiXCmfOk7VC7gKy1IynoVJlODFQWPe5k19C2szT10ZP1yWKl6jmp6UyYn+F9F36wyb0bMIkgzy9CzvDWLnBznbgjZIV3OT3PNtuChAH58OAWSM1oZviDqXC6eUUXFrJS2/UgbCAb4nUFXYM8gLI2Es6oUYG2SyvPM7Vi97XdV1MUz7OsbFcSDpG59gjJhoUe6w+v2jK9y/q63/jnnjF56tSp7D5rKq73tXYOQo7J6si/iaErVWcMBFGHVrtGeS1iyQJf6Kzt3rWyPQuduFC0349pRrXA07kuPaWO9Q0gTnWOE7tsE3GjkfPjQzAjODzSh48g00AkGvZ8h7BkFXu4yRxB1LXUke3qUip45QNE3eGn/Z4rB1v0UNfUZgJOPVJ1sa1DJwhTni7vs8q3H2CM5x7eqRCPFJQrkdyj1SxWjpPiWikqpaQlrvlYOZbIDc/HbXheehWaVRVwBM6koKrUQrI2PcpXasuaU3AWUX+YZdU0qEYJME8x9parCS/nYvgNrPdJzi9rVH3AbK5GvWEHlQu0iDZ2m42O98ZltHyEZimpi/+dh3irxbwG99LvQNqENaugt4ZdgbIgMaOIoiLVR+jP2WQwwqS+GT0vW3nCCzhptw/vqcuLzj/pv8VRkPdA+ND3ZepjOyb3rde/rPZta8Rn/vmtoNScbHvGfE/EO3rvzZ8rOTTlOiQwJDCJaIPAhAFdM42xW143Md/r9tzyfmNfOcPZQ+yCJyZjY7ASXprOZfcj0VP5ZgXhpfh2XEbDZ/zbTaz3I6Xt5RnFzz6Dg6Pc+hGPvQrSlwwd5t5U+Jjng1q2arNNbJjlHIJNz4R7Tv0PIPU9kB/09Hij+WByOh/rj8K8kCg84X2pzc+VIbqRnpcJCLEnfq6Dkm93U9/aFvuAnlfv3P/AXPmnH4uCgAA"),t="text/css"):"status"===i.r?(s.body=atob("H4sIAAAAAAAACpWQS07DMBRFt2JlBIMkzQCJgesFICQGdAMvtqs49SfkvbTNfrIGNpCNoeZHC+XT8T0+PjYnyK1m0gLiOnJMykhwqgUnJZ7BkGYlsFCU0CAnxYxaY6z8jEznDtnjSrwMEPMtLaB0J4kCAvBJkszegdyh9gy1NaQXHmm5+7Xvil3/7llhPMGF1YeDuFAhtW1VmQVwQemF2BgLy2L8NgieDm8WXJn9/PCtPbKtPcYu5LEMNroYSZ62jLn64dvgKFtFgudzMKO+833Xd56nueCpMnvBxz8eCiqzuhpwrtoE0g01Dn6RjcdITtYz6Uhdy7f/yC+a4LT38FN9dkP9H67sa/Nn+QBcsY8EytpUJGr99oR3EUEeIwE1mJQY3fN0mj8AnRW/d9oCAAA="),t=r):"status.js"===i.r?(s.body=atob("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"),t=c):"history"===i.r?(s.body=atob("H4sIAAAAAAAACmWNOw7CMBBEr2K5gsJY9JuVaGkoOIF/IRuMDN5NlNweEQWElGaK90YzEGlUITvmRrd5Um2ezKN4E0rWCH9SwscdNYI4nxOCVASJP638TeOJ7m4DL13vBt7ga8okCeyy40ucFcWGTUcsCHY9sZHGb3Ko9BSs6XXmnRbnl26p86FnvQe7+jdGEOBV0gAAAA=="),t=r):"history.js"===i.r?(s.body=atob("H4sIAAAAAAAAClWS0WrbMBSGX0U9ZEOaHbdd2E0cOWxrYRctg8a7MmY9cY5jbaqVSSctwfXb9E36YsMOGynoRgfp+38+qbPEwuiiTCvXBhZrzTrr/gQJYdqYwKAS07bkv+W3NxoW7LMFb0TlbNhhq2fZtRHDMecN4uKcN9ninH0GffqIXlQaw6GtxIAc9l6fglP2h87Ukp+f2721WgdGJuWJ974Va6lSU0tgXE+PCQfQGis2j5TjWo1AilHjExoWW+IrZJQ/7m5WESy9bt4bDZFpA48cTNxvNaSdSaMx2SCjSiy1W25OEnuygYSp5aeL2ZnWmFRu86aRP7UBae28JOFqYZLgPEvJsVc688VFOeXiolTHmuFoDuKg5bAifT9atBiChtowZJOudv4BOTcPJFt6ElfIJC9p9oFGTj/KvVfReDPwwZKGylnn55OOistyCVtP1MIcPG2gH4jH8ffmF+6D2L2+vL5YSzD/P3EmwBtuNulW+ef8+ucqvyuo+FiWy8TTzmJFEoR8FwQGNgpigH+FIjg++KmZSIe+7yvkqpGsuuFjOUsJee+8ZBWfSuS+Tyup4q9fVsluHxpZqf4v8DUOEZQCAAA="),t=c):"config"===i.r?(s.body=atob("H4sIAAAAAAAACpVW207jSBD9lZZXq4EH5+JhZxByWvIDIwIhGW0Cq32s2A0u3N32uMths8/7Kf4GfsA/NvItiQ2BnZdE7rqdPlWnbDfADcNg4j882pL5EoyZkM9nEAAB6MFg4A4D3HB378cMbaWYBGgSCdsLHWtRm+toi3y2tmqfh1iTbfBfcTEeOELxv2eX0+XlinnLy9XdzfJy1SQnWEvRxivm+xZ3KeUuBfwWoPxzjZDCpxLCI3fjhDDWbAMyE5MH5MssVtg9FYLfYxp3D+WGz4A2CL1j4jMURBm4w7pOW77B9Dw+H/FlkYdR8aKZN7uvIKFOsgrRBoiVt5w4nP3eAl8iphQriExG5fPoq+04F2wfFcB2F+UPo7/CAxIVjUfccezR18MIjY8h9WJqAocVg/02lFmO9mJxde3dLdlvrklAV61F7g7LB/5hVw5puSnyLRUvxhR5xYqEtZAtObRNxMQPhR+t43/KIkJztpgPF9++ucPGs+Frjgq7tOqdbRE+QWYIkv4sqDgQvN+0yp0IyrbIIg+D4oW6meOMTM3j2S5oVntqFlfFeoVivzd1I+6hBkaQRmgIhDG9oRrze0DNVJYRZZX5LZiZUaizjLCHUKHeNVqhbkNuirzINQnUogP0CNuoN7tq95CqLDOUaV0VK+3raGe+KnIqckIJB2k/6GWaHmvmd4ii2K4yRUbUdwsEAUrTTrj8g7smUwrSLZ9XM5QPE0QZU8lUY2hmEIPJQ9hOolHVYFv7qR82qd/UQSMCflP8t5zWQ/9L8734v3Soke2r4BUj70C6ms5X3p/etfdLgK5QE6TwBL2JGdsSVX87HC9+7d0sF3N25c3up7e33oqt7ubz6ccb+RCK9wT6CSIT92Xp2IlIe4pxzrhzFvZE4vCx0zs75+e9ky/8S+/kjPczfeafeycO72e2xzxWUD6UFLKTMavAn/a8nK6XU3vB6U7ArN6ZNREhB4xgU+QS2Ukk49OLdotS2s66Y/u14hUw6HC2b59jJ6bt3sVoxGzWNYoDYyuzVaYJVbkT0mb7Hob4ev+yCLtonNdwmPMGIOddRE4X0qv8HXhv5Pc1OR2E9e4QaZFHUZFjuzmOCc6xzY/dyqnWcVIWk7LImd1TSF2mCZOoWoXsPjMigwrDsuXHotQ7qmrettbBBQ1sRA16nRHtxmsFUgqtgR98WL16ZfPVYno7nc8Xq1de5Lc19p8KnTLlsoxTXzT1Dlax4e46/SA61r5EP5p8ekYdxM+DOBH6xBpap5/qdNYyFFJuNQtBVgKx2ovUv8ZPMSGeih/X5sQiWNt+rB/wcfBkrFJBtfknlPcDlXcKAAA="),t=r):"config.js"===i.r?(s.body=atob("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"),t=c):s.code=404:(s.body=atob("H4sIAAAAAAAACqVTwW4TMRD9FWMklIhkl5YLamxXiFaCXuCAekWOPclO49iLZzZRhPgbvqE/0B9Du5uEbkulIi6zO/PG7z3P7KoXPjne1VDxOhjVRhFsXGqIRq2BrXCVzQSsG15M3xnFyAHMl7vbTIR096ta3d2qsq/2B6Jdg94gbOuUWbgUGSJruUXPlfawQQfTLplgREYbpuRsAH0ijfK4ES5YIs2p7lP0+q+ae4xqjPsjVEejSo+bQ+wCQQDHbStGYqNSzZii2NjQgH5jPlc3tiHx8mQInByB0yFwegTeqrLnvifXyrhU78yrNs7EVUOE4hMltiGJkbKiyrDQFXNNZ2V5gz1SLFCwzUtg/W0ebFyZe4gqrRk/vNdhSnZOD3KjMNYNi3apOluPqd+I7SZp51Niyw0JV4Fbgdf754GAjFDBziGIRcqD/oPAtIPNVwxWlf370MF0v/NuGNM/FI+W8w+mKyROefe0ywcNR5sfuzo+2+qe53+8uhQXuHza6hA/On1PwM2KgJ9rtecZOu0juYw1G5cisbi4vNZbjD5ti5Ccbb/lImVcYiwwutB4oJFskVAlYjmeBWDhtU+uWUPkictgGS4DtJkGbXwxKI1gPLF1DdF/qDD4vmOe/K64V22bMny/ohb+sbFZkB6yyN60HM+ooOz0xeX1OZzJ86zlaygy1ME6GMn24nIi5UBzROOfE0ePKAPGlRzPHFGRIWhJvAtAFQDLtr3ofsZWSFLhiGQn178O6B3R3v5IUnFDcqzK/Yx/AxjaumtBBQAA"),t=r),s.headers=[["Content-Type",t]],s.headers.push(["Access-Control-Allow-Origin","*"]),e&&s.headers.push(["Content-Encoding","gzip"])}catch(t){log("server error: "+t),s.code=500}s.send()}),Timer.set(1e4,!0,loop),loop();